# ComicsHub

## –ü—Ä–æ –∫—É—Ä—Å
–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π - –∏—Ç–æ–≥ –º–æ–µ–π —Ä–∞–±–æ—Ç—ã –≤ –∫—É—Ä—Å–µ –æ—Ç **YADRO** –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ Golang**.  
–ö—É—Ä—Å –¥–ª–∏–ª—Å—è **10 –Ω–µ–¥–µ–ª—å**: –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é - –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞.  
**Task10** - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ—Ä–∏—Å—Ç–∞–π–ª –ø—Ä–æ–µ–∫—Ç: ‚Äú–¥–µ–ª–∞–µ–º —á—Ç–æ —Ö–æ—Ç–∏–º‚Äù, –æ–±—ä–µ–¥–∏–Ω—è–µ–º –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º –≤—Å—ë, —á—Ç–æ –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —Ä–∞–Ω–µ–µ.

## –û –ø—Ä–æ–µ–∫—Ç–µ

**ComicsHub** - –º–∏–Ω–∏-–ø–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ –∫–æ–º–∏–∫—Å–∞–º **xkcd**:
- `update` —Å–∫–∞—á–∏–≤–∞–µ—Ç –∫–æ–º–∏–∫—Å—ã —Å xkcd –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –≤ Postgres (—á–µ—Ä–µ–∑ migrations)
- `words` –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ç–µ–∫—Å—Ç (stop-words + stemming)
- `search` –∏—â–µ—Ç –∏ —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç, —É–º–µ–µ—Ç indexed search
- `api` - REST gateway —Å middleware (JWT / rate limits / require user)
- `nats` - —Å–æ–±—ã—Ç–∏—è ‚Äú–±–∞–∑–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å‚Äù -> `search` –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å
- `favorites` - –∏–∑–±—Ä–∞–Ω–Ω–æ–µ (CRUD) –ø–æ `user_id`
- `auth` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (email/password + Telegram login-or-register), –≤—ã–¥–∞—ë—Ç JWT
- `bot` - Telegram-–±–æ—Ç –Ω–∞ **aiogram**, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç API

**–°—Ç–µ–∫:** Go 1.25+, gRPC, REST, PostgreSQL, NATS, Docker Compose, Minikube + Kustomize, aiogram (Python).  
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ - **Ports & Adapters (Hexagonal)**, –∫–æ–Ω—Ñ–∏–≥–∏ —á–µ—Ä–µ–∑ **cleanenv**, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ **slog**.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∏—Ç–æ–≥)

–ö–æ—Ä–æ—Ç–∫–æ –ø–æ –ø–∞–ø–∫–∞–º:
- `search-services/` - Go-–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (`api`, `words`, `update`, `search`, `favorites`, `auth`) + `proto/`
- `bot/comicsbot/` - Telegram-–±–æ—Ç (aiogram)
- `tests/` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- `k8s/` - base + overlays/minikube (Kustomize)
- `compose.yaml`, `compose.core.yaml`, `Makefile` - –∑–∞–ø—É—Å–∫/—Ç–µ—Å—Ç—ã/–≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥—ä—ë–º–∞

## –°–µ—Ä–≤–∏—Å—ã

### api (REST gateway)
- –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä—É—á–∫–∏ (–≤ Task10 —è —Ä–∞–∑–¥–µ–ª–∏–ª public/internal)
- middleware:
  - JWT / require user
  - concurrency limiter (–¥–ª—è `/api/search`)
  - rate limiter (–¥–ª—è `/api/isearch`)
- –ø—Ä–æ–∫—Å–∏ –∫ gRPC —Å–µ—Ä–≤–∏—Å–∞–º (words/update/search/auth/favorites)

### words (gRPC)
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ñ—Ä–∞–∑—ã:
  - lowercase
  - —á–∏—Å—Ç–∫–∞ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏
  - stop-words —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
  - stemming (snowball)
  - unique —Ç–æ–∫–µ–Ω—ã

### update (gRPC)
- migrations + Postgres
- worker pool (concurrency)
- idempotent update: –¥–æ–∫–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∏–∫—Å—ã
- –æ—Ç–¥–∞—ë—Ç stats/status
- –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ NATS –ø—Ä–∏ Update/Drop

### search (gRPC)
- –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ + —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
- indexed search (inverted index)
- –ø–æ–¥–ø–∏—Å—á–∏–∫ NATS: ‚ÄúDB updated‚Äù -> rebuild index

### favorites (gRPC)
- —Ö—Ä–∞–Ω–∏—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–º–∏–∫—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- CRUD:
  - add / list / delete

### auth (gRPC)
- email/password login & register (bcrypt + JWT)
- Telegram login-or-register (–µ–¥–∏–Ω—ã–π user + –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –≤—Ö–æ–¥–∞)

### bot (aiogram)
- Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ–¥–∏—Ç –≤ API gateway:
  - browse / search / random
  - favorites (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/—É–±—Ä–∞—Ç—å)
  - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ internal endpoint (login-or-register)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker Compose)

### –ü–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```bash
make up
```

### –ü–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã, –∫—Ä–æ–º–µ —Ç–≥ –±–æ—Ç–∞
```bash
make core-up
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volume
```bash
make down -v
```

### –¢–µ—Å—Ç—ã
- –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:
```bash
make unit
```

- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
```bash
make test
```

## Kubernetes (Minikube)

–Ø –ø–æ–¥–Ω—è–ª dev-–∫–ª–∞—Å—Ç–µ—Ä –≤ **Minikube** –∏ –æ—Ñ–æ—Ä–º–∏–ª –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ **Kustomize**: `k8s/base` + `k8s/overlays/minikube`.  
–ü–æ–ª–Ω—ã–π ‚Äú–≥–∞–π–¥ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏‚Äù —è –¥–µ—Ä–∂—É –≤ –≤–µ—Ç–∫–µ **`kubernetes`** - —Ç–∞–º –æ–ø–∏—Å–∞–Ω–æ –∫–∞–∫:
- —Å–æ–∑–¥–∞—Ç—å 3-–Ω–æ–¥—ã –∫–ª–∞—Å—Ç–µ—Ä
- –≤–∫–ª—é—á–∏—Ç—å –∞–¥–¥–æ–Ω—ã
- —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –≤–Ω—É—Ç—Ä—å minikube
- –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å overlay –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API –Ω–∞ macOS (tunnel / port-forward)


# –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –∫—É—Ä—Å–∞:
## –ö–æ—Ä–æ—Ç–∫–æ –ø–æ —Ç–∞—Å–∫–∞–º

- **Task1:** REST –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã `hello` + `fileserver` (CRUD —Ñ–∞–π–ª–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **Task2:** gRPC –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã `petname` + `words` (streaming + stemming/stopwords)
- **Task3:** REST API gateway –Ω–∞–¥ gRPC (`/ping`, `/api/words`), Ports & Adapters
- **Task4:** `update` —Å–µ—Ä–≤–∏—Å: Postgres + migrations + xkcd API + concurrency + —Å—Ç–∞—Ç—É—Å/—Å—Ç–∞—Ç—ã
- **Task5:** `search` –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞: –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ + —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä—É—á–Ω–æ–π —Å–∫–æ—Ä–∏–Ω–≥)
- **Task6:** `search` —Å –∏–Ω–¥–µ–∫—Å–æ–º: inverted index + –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ TTL
- **Task7:** –Ω–∞–≥—Ä—É–∑–∫–∞ –∏ –¥–æ—Å—Ç—É–ø: concurrency/rate limit + JWT –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä—É—á–µ–∫
- **Task8:** event-driven: NATS pub/sub, update->search (rebuild index –ø–æ —Å–æ–±—ã—Ç–∏—é)
- **Task9:** —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: unit 35% + component tests (gRPC via bufconn)
- **Task10:** freestyle ComicsHub: favorites, auth v2 (telegram), bot, k8s, public/internal gateway


## Task1 - Hello & Fileserver (REST)

**Hello & Fileserver - –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç.**  
–î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —á–µ—Ä–µ–∑ REST API:
- `hello` - —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- `fileserver` - —Ñ–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π

–ó–∞–ø—É—Å–∫:
```bash
make up
make down
make test
```

–í –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ –ø–æ–¥–∫–ª—é—á—ë–Ω middleware Logging, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.  
–ü—Ä–∏–º–µ—Ä—ã —Ä—É—á–µ–∫:
- `GET /ping`
- `GET /hello?name=Andrew`
- `POST /files` (upload)
- `GET /files` (list)
- `GET /files/{path}` (download)
- `PUT /files/{path}` (update)
- `DELETE /files/{path}` (delete)


## Task2 - Petname & Words (gRPC)

–î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –ø–æ gRPC:
- **Petname** - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–º—ë–Ω (golang-petname)
  - `Generate` / `GenerateMany` (streaming)
  - –æ—à–∏–±–∫–∏: `InvalidArgument`, –µ—Å–ª–∏ words/names <= 0
- **Words** - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Ñ—Ä–∞–∑ (snowball + stopwords)
  - `Norm`
  - –æ—à–∏–±–∫–∞: `ResourceExhausted`, –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ > 4KiB

–ó–∞–ø—É—Å–∫/—Ç–µ—Å—Ç—ã:
```bash
make up
make down
make test
```

–ü—Ä–∏–º–µ—Ä—ã `grpcurl`:
```bash
grpcurl -plaintext localhost:28081 petname.PetnameGenerator.Ping
grpcurl -plaintext -d '{"words":3,"separator":"-"}' localhost:28081 petname.PetnameGenerator.Generate
grpcurl -plaintext -d '{"phrase":"follower brings bunch of questions"}' localhost:28082 search.Words.Norm
```


## Task3 - API Gateway (REST –ø–æ–≤–µ—Ä—Ö gRPC)

–¶–µ–ª—å - —Å–¥–µ–ª–∞—Ç—å REST-—à–ª—é–∑ –Ω–∞–¥ –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ gRPC-—Å–µ—Ä–≤–∏—Å–∞–º–∏:
- `GET /ping` –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (`words` –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ)
- `GET /api/words?phrase=...` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ JSON-–æ–º
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π mapping –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä `ResourceExhausted` -> HTTP 400)
- –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ **Ports & Adapters**, –∫–æ–Ω—Ñ–∏–≥–∏ —á–µ—Ä–µ–∑ `cleanenv`, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `slog`


## Task4 - Update: XKCD API + Postgres

`update`:
- –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç migrations (—Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã)
- —Ö–æ–¥–∏—Ç –≤ xkcd API –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–º–∏–∫—Å—ã –≤ Postgres
- –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ `words`
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
  - `/api/db/stats`
  - `/api/db/update` (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ, –¥–æ–∫–∞—á–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö)
  - `/api/db/status` (idle/running)
- –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ update: –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç HTTP 202 Accepted
- concurrency: –≤–æ—Ä–∫–µ—Ä-–ø—É–ª (10 –≥–æ—Ä—É—Ç–∏–Ω)


## Task5 - Search –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞: —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ

–Ø –∑–∞—Ö–æ—Ç–µ–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –æ—Ç–¥–∞–ª–µ–Ω–Ω–æ –ø–æ—Ö–æ–∂–µ–µ –Ω–∞ elasticsearch, —Ç–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é, –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ BM25.  
–í elasticsearch –∑–∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç –º–æ–¥–µ–ª—å BM25, –∫–æ—Ç–æ—Ä–∞—è –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞:

- TF - —á–∞—Å—Ç–æ—Ç—É —Ç–µ—Ä–º–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞  
- IDF - —Ä–µ–¥–∫–æ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏  
- field-length norm - –¥–ª–∏–Ω—É –ø–æ–ª—è  

–ü–æ–∫–∞ BM25 –º—ã –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏, –Ω–æ —Å–¥–µ–ª–∞–ª–∏ —Ä—É—á–Ω—É—é –≤–µ—Ä—Å–∏—é —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø–ª–æ—Ö–æ (—Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ üòÅ).  
–í –º–æ–µ–º —Ä–µ—à–µ–Ω–∏–∏ —è –∑–∞–∫–ª–∞–¥—ã–≤–∞–ª –∏–¥–µ—é - —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–π –≤–µ—Å. –ë–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É, –ø–æ—Å–ª–µ –ø—Ä–æ–≤–∞–ª–∏–≤—à–µ–≥–æ —Ç–µ—Å—Ç–∞, —è –ø–æ–Ω—è–ª —á—Ç–æ –≤–∞–∂–Ω–æ –µ—â—ë —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏—Ö –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–≥–∏–∫–∞:
1) –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ—Ä–∞–∑—É —á–µ—Ä–µ–∑ words, –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã  
2) –ë–î –æ—Ç–¥–∞—ë—Ç –≤—Å–µ –∫–æ–º–∏–∫—Å—ã, –≥–¥–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω (–ø–æ title/alt/words)  
   (–≤ update —è –∏–∑–º–µ–Ω–∏–ª –º–æ–¥–µ–ª—å: —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–∏ –ø–æ–ª—è –≤ –ë–î)  
3) –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∏–∫—Å–æ–≤:
   - 3.1) **–í–µ—Å–∞ –ø–æ–ª–µ–π:** —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ title –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ words  
   - 3.2) **–®–∏—Ä–∏–Ω–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–æ–∫–µ–Ω–æ–≤:** –≤–∞–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ ‚Äú–≥–¥–µ —Å–æ–≤–ø–∞–ª–æ‚Äù, –Ω–æ –∏ ‚Äú—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤‚Äù –Ω–∞—à–ª–∏  
     `coveredTokens` —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É

–ü—Ä–∏–º–µ—Ä:

| –ö–æ–º–∏–∫—Å | –ö–∞–∫–∏–µ —Ç–æ–∫–µ–Ω—ã —Å–æ–≤–ø–∞–ª–∏       | coveredTokens |
| ------ | -------------------------- | ------------: |
| A      | linux, video, machine, cpu |             4 |
| B      | hackers                    |             1 |

–ö–æ–º–∏–∫—Å A –¥–æ–ª–∂–µ–Ω —Å—Ç–æ—è—Ç—å –≤—ã—à–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–º–∏–∫—Å B —Å–æ–≤–ø–∞–ª –≤ title. –¢–µ–º —Å–∞–º—ã–º –º—ã —Å–¥–µ–ª–∞–ª–∏ ‚Äú—à–∏—Ä–∏–Ω—É –ø–æ–∫—Ä—ã—Ç–∏—è‚Äù –≤–∞–∂–Ω–µ–µ, —á–µ–º ‚Äú–≥–ª—É–±–∏–Ω—É‚Äù.

3.3) –ò—Ç–æ–≥–æ–≤—ã–π score:  
–ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ –≤–µ—Å–∞ –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ–º, –ø–ª—é—Å –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞ —á–∏—Å–ª–æ –ø–æ–∫—Ä—ã—Ç—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤.

4) –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
- –ø–æ score (desc)
- –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º score - –ø–æ ID (asc), —á—Ç–æ–±—ã –≤—ã–¥–∞—á–∞ –±—ã–ª–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π

–ü—Ä–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
–ü–æ–∏—Å–∫ –≤ –ø–æ–ª—è—Ö —É—Å–∫–æ—Ä–µ–Ω —á–µ—Ä–µ–∑ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π `title/alt/words` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ `map[string]bool` —Å –ø–æ–º–æ—â—å—é `mapSet`.  
–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –¥–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ O(1) –Ω–∞ lookup.

–û–±—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∫–æ–º–∏–∫—Å–∞ - `O(L + T)`, –≥–¥–µ:
- `L` - —Å—É–º–º–∞ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö —Ç—Ä—ë—Ö –ø–æ–ª–µ–π
- `T` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–∞

–ë–µ–∑ –º–∞–ø—ã –±—ã–ª–æ –±—ã O(L * T), –ø—Ä–∏ –±–æ–ª—å—à–æ–º L –±—ã–ª–∞ –±—ã –¥–æ–ª–≥–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞


## Task6 - Search —Å –∏–Ω–¥–µ–∫—Å–æ–º

–Ø –≤–≤—ë–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É **InvertedIndex**:

```go
type InvertedIndex struct {
	mu      sync.RWMutex
	byToken map[string][]int // token -> —Å–ø–∏—Å–æ–∫ id –∫–æ–º–∏–∫—Å–æ–≤
	docs    map[int]Comics   // id -> –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –∫–æ–º–∏–∫—Å–∞
}
```

–ò–¥–µ—è:
- `byToken` —Ö—Ä–∞–Ω–∏—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `—Ç–æ–∫–µ–Ω -> —Å–ø–∏—Å–æ–∫ –∫–æ–º–∏–∫—Å–æ–≤`, –≥–¥–µ —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è
- `docs` —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –∫–æ–º–∏–∫—Å–∞ (ID, URL, Title[], Alt[], Words[]), —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å, –Ω–µ –ª–µ–∑—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –ë–î

–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞:
- –æ–¥–∏–Ω —Ä–∞–∑ —á–∏—Ç–∞—é –≤—Å–µ –∫–æ–º–∏–∫—Å—ã –∏–∑ –ë–î
- –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–∏–∫—Å–∞:
  - –∫–ª–∞–¥—É –µ–≥–æ –≤ `docs[id] = c`
  - –ø—Ä–æ—Ö–æ–∂—É—Å—å –ø–æ —Ç–æ–∫–µ–Ω–∞–º `Title/Alt/Words`
  - —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π `seen` —Å–ª–µ–∂—É, —á—Ç–æ–±—ã –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –¥–≤–∞ —Ä–∞–∑–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∫–æ–º–∏–∫—Å–∞
  - –¥–æ–±–∞–≤–ª—è—é `comicID` –≤ `byToken[token]`
- –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –≤—Å–µ–º—É —Å–ø–∏—Å–∫—É –∞—Ç–æ–º–∞—Ä–Ω–æ –ø–æ–¥ –º—å—é—Ç–µ–∫—Å–æ–º –∑–∞–º–µ–Ω—è—é —Å—Ç–∞—Ä—ã–µ `byToken/docs` –Ω–∞ –Ω–æ–≤—ã–µ

–õ–æ–≥–∏–∫–∞ –≤ service –ø–æ—á—Ç–∏ –Ω–µ –ø–æ–º–µ–Ω—è–ª–∞—Å—å: —è –≤—ã–Ω–µ—Å –≤ –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ –¥–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É.


## Task7 - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏ –¥–æ—Å—Ç—É–ø–æ–º

–í API gateway –¥–æ–±–∞–≤–∏–ª middleware:
- **concurrency limiter** –¥–ª—è `/api/search` (–ø—Ä–∏ –ª–∏–º–∏—Ç–µ -> HTTP 503)
- **rate limiter** –¥–ª—è `/api/isearch` (–Ω–µ 503, –∞ ‚Äú–ø—Ä–∏—Ç–æ—Ä–º–∞–∂–∏–≤–∞–µ—Ç‚Äù –∑–∞–ø—Ä–æ—Å—ã –¥–æ –Ω—É–∂–Ω–æ–≥–æ RPS)

–î–æ–±–∞–≤–∏–ª –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞:
- `POST /api/login` –≤—ã–¥–∞—ë—Ç JWT, –µ—Å–ª–∏ –∏–º—è/–ø–∞—Ä–æ–ª—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `ADMIN_USER/ADMIN_PASSWORD`
- –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä—É—á–∫–∏ update/drop –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–æ–∫–µ–Ω–∞ –≤ `Authorization: Token ...`
- TTL —Ç–æ–∫–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è `TOKEN_TTL`


## Task8 - NATS —Å–æ–±—ã—Ç–∏—è update -> search

–í —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ —è –¥–æ–±–∞–≤–∏–ª —Å–æ–±—ã—Ç–∏–π–Ω—É—é —à–∏–Ω—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â—É—é –º–µ–∂–¥—É 2 —Å–µ—Ä–≤–∏—Å–∞–º–∏ update –∏ search.  
–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π - **NATS** –≤ —Å—Ç–∏–ª–µ **pub/sub**: update –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∞–∑—ã, –∞ search –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å.

### Publisher (update)
–í update —è —Å–¥–µ–ª–∞–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞–±–æ—Ç—É —Å –±—Ä–æ–∫–µ—Ä–æ–º. –û–Ω –¥–µ—Ä–∂–∏—Ç –¥–æ–ª–≥–æ–∂–∏–≤—É—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —à–ª—ë—Ç —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ –æ—á–∏—Å—Ç–∫–µ –ë–î. –õ–æ–≥–∏–∫–∞ —Å–ª–µ–¥—É—é—â–∞—è:
- —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ `NewPublisher`
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ `NotifyDBUpdated`
- –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ `Close` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞

–Ø —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –¥–µ—Ä–∂–∞–ª –±—Ä–æ–∫–µ—Ä –≤–Ω—É—Ç—Ä–∏ –∞–¥–∞–ø—Ç–µ—Ä–∞: –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è —ç—Ç–æ –ø—Ä–æ—â–µ, —á–µ–º ‚Äú–≥–ª–æ–±–∞–ª—å–Ω—ã–π shared broker‚Äù –Ω–∞ —É—Ä–æ–≤–Ω–µ main.

### Subscriber (search)
–í search —è —Å–¥–µ–ª–∞–ª subscriber, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ subject `xkcd.db.update` –∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `RebuildIndex`:
- —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ NATS
- –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –∏ –ø–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
- –≥–æ—Ä—É—Ç–∏–Ω–∞ —á–∏—Ç–∞–µ—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `RebuildIndex`
- –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - graceful shutdown (unsubscribe + close)

### Flush –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ update –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: `nc.Publish()`, –∑–∞—Ç–µ–º `nc.Flush()`.

`Publish()` –∫–ª–∞–¥—ë—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –±—É—Ñ–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞. –ï—Å–ª–∏ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–µ—Ä–≤–∏—Å –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è - —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —É–π—Ç–∏.  
`Flush()` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞ –≤—Å–µ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ –Ω–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –Ω–µ –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ NATS.

–ê–Ω–∞–ª–æ–≥–∏—è:
- `Publish()` - –ø–æ–ª–æ–∂–∏—Ç—å –ø–∏—Å—å–º–æ –≤ –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫
- `Flush()` - –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ—á—Ç–∞–ª—å–æ–Ω–∞ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∏—Å—å–º–æ –≤ —Ä—É–∫–∏

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∏–ª–∞—Å—å –ø—Ä–æ—Å—Ç–∞—è, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–æ–±—ã—Ç–∏–π–Ω–∞—è —à–∏–Ω–∞: update —á–µ—Å—Ç–Ω–æ —Å–æ–æ–±—â–∞–µ—Ç ‚Äú–ë–î –∏–∑–º–µ–Ω–∏–ª–∞—Å—å‚Äù, search —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å.


## Task9 - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–≤–µ—Ç! –í —ç—Ç–æ–π —Ç–∞—Å–∫–µ —è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ª–æ–≥–∏–∫—É —è–¥—Ä–∞. –ü–ª—é—Å –¥–æ–±–∞–≤–∏–ª 2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–∞ –¥–ª—è gRPC-–∞–¥–∞–ø—Ç–µ—Ä–æ–≤ (search –∏ update), —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –æ—à–∏–±–æ–∫/–æ—Ç–≤–µ—Ç–æ–≤ —É–∂–µ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç–æ—è—â–∏–π gRPC —Å—Ç–µ–∫.

### Words - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–∏—Å, —Å –Ω–µ–≥–æ –∏ –Ω–∞—á–∞–ª))
1) `set.go` - –ø–æ–∫—Ä—ã–ª —Å–µ—Ç–∏–∫ –¥–≤—É–º—è —Ç–µ—Å—Ç–∞–º–∏:
- —Å–æ–∑–¥–∞–Ω–∏–µ set –ø—Ä–∏ –ø–ª–æ—Ö–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç–µ - –¥–∞–∂–µ –µ—Å–ª–∏ capacity –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π, set –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è –∏ –Ω–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–∞–Ω–∏–∫–µ
- –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å Add/–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å Has - –ø–µ—Ä–≤—ã–π Add("hello") true, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π false, Has –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

1) `words.go` (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è) - —Å–¥–µ–ª–∞–ª 5 —Ç–µ—Å—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:
- –ø—É—Å—Ç–∞—è —Ñ—Ä–∞–∑–∞
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞ + —É–¥–∞–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏
- —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã –≤—ã—á–∏—â–∞—Ç—å—Å—è (—á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è —Å–ª–æ–≤–∞ + –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è –∏ –≥–ª–∞–≥–æ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã will)
- —Ü–∏—Ñ—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –Ω–æ –¥—É–±–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è, –∞ –ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- —Å—Ç–µ–º–º–∏–Ω–≥ + —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è

### Update - —Å–µ—Ä–≤–∏—Å —Å–ª–æ–∂–Ω–µ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—Å—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
Update –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ë–î, words-—Å–µ—Ä–≤–∏—Å–∞ –∏ –≤–Ω–µ—à–Ω–µ–≥–æ API xkcd. –ü–æ—ç—Ç–æ–º—É –≤ —Ç–µ—Å—Ç–∞—Ö —è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–ª —è–¥—Ä–æ: –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é —Ñ–µ–π–∫–∏, —á—Ç–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

1) –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞:
- `TestNewService_RejectsBadConcurrency` - –≤–∞–ª–∏–¥–∏—Ä—É—é concurrency < 1

2) –°—Ç–∞—Ç—É—Å:
- `TestService_Status` - Idle –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, Running –ø—Ä–∏ —Ñ–ª–∞–≥–µ

3) Drop:
- `TestService_Drop_AlreadyRunning` - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (ErrAlreadyExists)
- `TestService_Drop_CallsDB` - drop —Ä–µ–∞–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ë–î –∏ –Ω–µ —Ç–µ—Ä—è–µ—Ç –æ—à–∏–±–∫—É

4) Stats:
- `TestService_Stats_HappyPath` - —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ db.Stats() + xkcd.LastID()
- `TestService_Stats_DBError` - –ø—Ä–æ–±—Ä–æ—Å –æ—à–∏–±–∫–∏ DB

1) Update - –∑–∞—â–∏—Ç–∞ –∏ –ø—Ä–æ–±—Ä–æ—Å –æ—à–∏–±–æ–∫:
- `TestService_Update_AlreadyRunning`
- `TestService_Update_PropagatesLastIDError / TestService_Update_PropagatesIDsError`

1) Update - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:
- `TestService_Update_SkipsExistingIDs`
- `TestService_Update_NotFoundAddsEmptyComic`
- `TestService_Update_WordsErrorsBecomeEmptySlices`
- `TestService_Update_RespectsContextCancel`
- `TestService_Update_CapsWorkersTo64`

### Search - —Ç–µ—Å—Ç—ã –Ω–∞ –∏–Ω–¥–µ–∫—Å –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
1) `index_test.go` - inverted index:
- BuildAndLookup
- DocsByIDs_ReturnsExistingOnly

1) `service_errors_test.go` - –¥–æ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–±—Ä–æ—Å:
- Ping - –æ—à–∏–±–∫–∞ –ë–î
- Find/IndexedSearch - –æ—à–∏–±–∫–∏ words –∏ db
- RebuildIndex - –æ—à–∏–±–∫–∞ db.All()
- IndexedSearch —Å –ø—É—Å—Ç—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏ - ErrNonePhrase

1) `service_test.go` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ:
- makeSet —É–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
- scoreComic: 0 –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–º –ø–æ–∫—Ä—ã—Ç–∏–∏, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –±–æ–ª—å—à–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- rangComics —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ score (desc), –ø–æ id (asc), –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç limit
- Service.Find / Service.IndexedSearch - –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ limit, RebuildIndex + IndexedSearch

### api (rest) –∏ middleware
- `api_test.go` - —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã http-—Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ `httptest`
- `auth_test.go`, `jwt_test.go`, `limits_test.go` - —Ç–µ—Å—Ç—ã middleware (login/jwt/limits)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã (gRPC)
–î–æ–±–∞–≤–∏–ª 2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–∞:
- `search/adapters/grpc/server_test.go`
- `update/adapters/grpc/server_test.go`

–û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **bufconn**: –Ω–∞—Å—Ç–æ—è—â–∏–π grpc.Server + grpc.Client, –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—è—é:
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–æ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ `codes.*`
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ protobuf-–æ—Ç–≤–µ—Ç–æ–≤
- side-effects (–Ω–∞–ø—Ä–∏–º–µ—Ä notifier –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º Update/Drop)


## Task10 - Freestyle: ComicsHub

**ComicsHub - —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å –≤ –∏—Ç–æ–≥–µ.**

–°–µ—Ä–≤–∏—Å—ã:
- api - REST gateway (–ø—É–±–ª–∏—á–Ω—ã–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä—É—á–∫–∏), middleware (JWT / rate limits / require user)
- words - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
- update - –∑–∞–≥—Ä—É–∑–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–∏–∫—Å–æ–≤, –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
- search - –∏–Ω–¥–µ–∫—Å–∞—Ç–æ—Ä + –ø–æ–∏—Å–∫, –ø–æ–¥–ø–∏—Å—á–∏–∫ NATS, –æ—Ç–¥–∞—á–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- auth - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (email/pass + Telegram login-or-register), –≤—ã–¥–∞—á–∞ JWT
- favorites - –∏–∑–±—Ä–∞–Ω–Ω–æ–µ (CRUD), —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–∏–∫—Å–æ–≤
- bot (aiogram) - Telegram-–±–æ—Ç –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç API

### 1) Search
–°–Ω–∞—á–∞–ª–∞ —è —Ä–∞—Å—à–∏—Ä–∏–ª search, —á—Ç–æ–±—ã –æ–Ω —É–º–µ–ª –∫–∞–∫ –≤ xkcd:
- –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∏–∫—Å–æ–≤ (paging/limit)
- –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–∏–∫—Å –ø–æ id
- –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–Ω–¥–æ–º–Ω—ã–π –∫–æ–º–∏–∫—Å

–†–æ—É—Ç—ã –≤ gateway:
- `GET /api/comics`
- `GET /api/comics/{id}`
- `GET /api/comics/random`

### 2) Auth
–ù–∞ —ç—Ç–æ–º –º–æ–º–µ–Ω—Ç–µ —è –µ—â—ë –Ω–µ –∑–Ω–∞–ª —á—Ç–æ —Ö–æ—á—É –±–æ–ª—å—à–µ: –≤–µ—Ä—Å—Ç–∞—Ç—å —Ñ—Ä–æ–Ω—Ç –∏–ª–∏ –ø–∏—Å–∞—Ç—å —Ç–≥ –±–æ—Ç–∞, –Ω–æ —Ç–æ—á–Ω–æ —Ö–æ—Ç–µ–ª —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–º–∏–∫—Å—ã. –ü–æ—ç—Ç–æ–º—É —Å–¥–µ–ª–∞–ª –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ email/password –∏ middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞.

- Register: email + password -> hash -> –∑–∞–ø–∏—Å—å -> JWT
- Login: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è -> JWT
- –≤ api –¥–æ–±–∞–≤–∏–ª middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT

### 3) Favorites
–ü–æ—è–≤–∏–ª—Å—è —Å–µ—Ä–≤–∏—Å favorites, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç ‚Äú–º–æ–∏ –∫–æ–º–∏–∫—Å—ã‚Äù –ø–æ user_id:
- –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- —É–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

–†–æ—É—Ç—ã:
- `GET /api/mycomics`
- `POST /api/mycomics/{id}`
- `DELETE /api/mycomics/{id}`

### 4) Auth v2 (Telegram login-or-register)
–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è Telegram-–±–æ—Ç–∞ - –∏ —è —É–ø—ë—Ä—Å—è –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. –Ø —Ö–æ—Ç–µ–ª —á—Ç–æ–±—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Telegram –±—ã–ª–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ—Ç email/password. –†–µ–∞–ª–∏–∑–æ–≤–∞–ª —ç—Ç–æ —á–µ—Ä–µ–∑ 3 —Ç–∞–±–ª–∏—Ü—ã:

- users - –µ–¥–∏–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≥–ª–∞–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, user_id)
- user_comicshub - –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è email/password
- user_telegram - –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è Telegram (tg_id + –ø—Ä–æ—Ñ–∏–ª—å)

–ú–Ω–µ –Ω—É–∂–µ–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π:
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–º–∏–∫—Å—ã ‚Äú–≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ‚Äù
- –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ –ë–î - —Å–æ–∑–¥–∞—Ç—å
- –µ—Å–ª–∏ –µ—Å—Ç—å - –Ω–∞–π—Ç–∏
- –∏ –≤—Å—ë —ç—Ç–æ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ UI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ Telegram

–≠—Ç–æ –∏ –µ—Å—Ç—å –∏–¥–µ—è login-or-register (–ø–æ —Å–º—ã—Å–ª—É –ø–æ—Ö–æ–∂–µ –Ω–∞ OAuth: –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ -> –Ω–∞—à–ª–∏/—Å–æ–∑–¥–∞–ª–∏ -> –≤—ã–¥–∞–ª–∏ —Ç–æ–∫–µ–Ω).

–í JWT payload —Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ users.user_id, –∞ –Ω–µ –ø–æ email. –ß—Ç–æ —ç—Ç–æ –¥–∞–ª–æ:
- —Å–µ—Ä–≤–∏—Å–∞–º –Ω–µ –Ω—É–∂–µ–Ω email - –∏–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ user_id
- –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –≤—Ö–æ–¥–∞
- –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å link accounts (—Å–≤—è–∑–∞—Ç—å Telegram —Å –≤–µ–±–æ–º)

### 5) Public / Internal gateway
–ß—Ç–æ–±—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä—É—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ Telegram-–±–æ—Ç–∞ –Ω–µ –±—ã–ª–∞ –ø—É–±–ª–∏—á–Ω–æ–π, —è —Ä–∞–∑–¥–µ–ª–∏–ª gateway:
- Public (:8080) - –≤–Ω–µ—à–Ω–∏–µ —Ä—É—á–∫–∏
- Internal (:8081) - —Ä—É—á–∫–∞ –¥–ª—è —Å–≤–æ–∏—Ö (–±–æ—Ç)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ –º–æ–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å:
- shared-secret –¥–ª—è internal
- NetworkPolicy –≤ k8s
- –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–µ—Ç—å

### 6) Secrets
–û—Ñ–æ—Ä–º–∏–ª —Å–µ–∫—Ä–µ—Ç—ã: `.env`, `.env.example`, `compose.core.yaml`, `Makefile`.  
–í—ã–Ω–µ—Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `.env`, –¥–æ–±–∞–≤–∏–ª `.env.example`, —Å–¥–µ–ª–∞–ª `compose.core.yaml` —á—Ç–æ–±—ã –ø–æ–¥–Ω–∏–º–∞—Ç—å —è–¥—Ä–æ –±–µ–∑ –±–æ—Ç–∞.

### 7) Kubernetes (Minikube) + Kustomize
–°–æ–±—Ä–∞–ª dev-–∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ minikube, –≤–∫–ª—é—á–∏–ª –∞–¥–¥–æ–Ω—ã, –Ω–∞—Å—Ç—Ä–æ–∏–ª `k8s/base` + `k8s/overlays/minikube`, –±–∏–ª–¥–∏–ª –æ–±—Ä–∞–∑—ã ‚Äú–≤–Ω—É—Ç—Ä—å‚Äù minikube –∏ –¥–µ–ø–ª–æ–∏–ª —á–µ—Ä–µ–∑ `kubectl apply -k`.

–ü–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥ –ø–æ —à–∞–≥–∞–º - –≤ –≤–µ—Ç–∫–µ **`kubernetes`**.


## Demo video
üé¨ –°–∫–∞—á–∞—Ç—å –¥–µ–º–æ –≤–∏–¥–µ–æ, mp4 (277MB): https://github.com/voronkov44/microservice-comics/releases/download/demo/comicshub.mp4

## –ß—Ç–æ –¥–∞–ª—å—à–µ

- —Ä–∞–∑–≤–∏–≤–∞—Ç—å UI/Frontend
- —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π account linking (Telegram ‚Üî Web)
- –ø–æ–¥—É–º–∞—Ç—å –æ JetStream (durable delivery, at-least-once)
- –¥–æ–±–∞–≤–∏—Ç—å observability (Prometheus/Grafana, tracing)

–°–ø–∞—Å–∏–±–æ **YADRO** –∑–∞ –∫—É—Ä—Å - 10 –Ω–µ–¥–µ–ª—å –±—ã–ª–∏ –æ—á–µ–Ω—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–º–∏ ‚ù§Ô∏è






