# Добавление шины событий для информирования search сервиса об обновлениях

## Цель

Ранее поисковая система полагалась на инициатор в search для периодической индексации комиксов.
Этот способ обладает рядом недостатков - несвоевременное перестроение индекса или перестроение,
когда данные вовсе не менялись. Требуется внедрить событийное управление перестройкой индекса
с помощью nats сервера. Сервер уже включен в текущий compose.yaml.

Задача - при обновлении базы в update сервисе генерировать событие, на которое будет подписан
search сервис. При получении этого события search сразу перестраивает индекс. Перед тестами
необходимо убедиться, что INDEX_TTL с 20s увеличен на 24h в compose.yaml файле для search сервиса.
Также необходимо сбрасывать индекс при "обнулении" базы.

В папке examples есть пример реализации генератора событий и трех подписчиков. Выберите вид
посписчика, который подойдет наилучшим способом к Вашей реализации микросервиса search.

Сервисы должны собираться и запускаться через модифицированный compose файл,
а также проходить интеграционные тесты - запуск специального тест контейнера.

## Критерии приемки

1. Микросервисы компилируются в docker image-ы, запускаются через compose файл и проходят тесты.
2. Можно использовать код из предыдущего задания.
3. Сервисы udpate и search конфигурируeтся через cleanenv пакет и должeны уметь запускаться как
с config.yaml файлом через флаг -config, так и через переменные среды, в этом задании - с
дополнительным BROKER_ADDRESS. Все необходимые переменные уже добавлены в compose.yaml.
4. Используется golang 1.25+, slog логгер.

## Материалы для ознакомления

NATS:

- [NATS main site](https://nats.io/)
- [Concepts](https://docs.nats.io/nats-concepts/core-nats)
- [Server Installation](https://docs.nats.io/running-a-nats-service/introduction/installation#getting-the-binary-from-the-command-line)
- [Hello World Nats](https://docs.nats.io/running-a-nats-service/clients)
- [Go Code Samples](https://github.com/nats-io/nats.go)
- [Настройка шины событий NATS & NSQ в Go](https://purpleschool.ru/knowledge-base/article/nats)
